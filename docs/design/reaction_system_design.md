# リアクション機能設計仕様書

## 1. 概要 (Concept)

ユーザーから受け取った「想い（リアクション）」を、単なる数字としてではなく、**投稿カード上に降り積もる「落書き」のようなビジュアル**として表現します。
「数字を競う」のではなく、「たくさんの想いに包まれる」体験を提供することを目的としています。

### コンセプトキーワード
*   **Graffiti / Wall**: 寄せ書きのように、みんなのリアクションが画面を埋め尽くす。
*   **No Numbers**: 誰かと比較する「数」は見せない。代わりに「量（密度）」で熱量を可視化する。
*   **Unlimited**: 上限を感じさせない、無限のキャンバス。

---

## 2. UI/UX 仕様

### A. 投稿カード表示 (Feed & Detail)
*   **背景演出 (Reaction Background)**:
    *   投稿カードの背景（テキストの下層）にリアクションアイコンを散りばめて表示。
    *   **透明度**: 文字の視認性を妨げないよう、不透明度 10%〜20% 程度で描画。
    *   **配置**: `Random` 関数を用いたランダム配置だが、**投稿IDをシード値**とすることで、リロードしても配置が変わらない（決定論的配置）を実現。
    *   **回転**: ランダムに回転させ、手書き/スタンプ感を演出。

### B. リアクション追加ボタン
*   **表示位置**:
    *   **フィード**: カード右下（コメントアイコンの左隣）。
    *   **詳細画面**: カードコンテンツの右下。
*   **アイコン**: `Icons.add_reaction_outlined`（顔マーク付きの＋アイコン）。
*   **挙動**: タップするとリアクション選択シートを表示。
    *   **制約**: 自分の投稿の場合、タップしてもシートは開かず、「自分の投稿にはリアクションできません」というメッセージを表示する。

### C. リアクション選択シート
*   **表示形式**: モーダルボトムシート。
*   **レイアウト**:
    *   LINE/Google Chat風のグリッド表示。
    *   文字（「いいね」等のラベル）は排除し、アイコンのみを `Wrap` で配置。
    *   約50種類のアイコンを選択可能。
    *   スクロール対応。
    *   ヘッダーに「×」ボタン（閉じる）を配置。

---

## 3. 技術仕様 (Technical Specs)

### A. データモデル
`posts/{postId}` ドキュメント内の `reactions` フィールドで管理。

```typescript
interface Post {
  // ...other fields
  reactions: {
    [reactionType: string]: number; // 例: { 'love': 5, 'banana': 2, 'star': 10 }
  };
}
```

*   **メリット**:
    *   ユーザーごとのリアクション履歴をすべて読み込む必要がなく、**Readコストが非常に低い**。
    *   ドキュメントサイズも小さく保たれる。

### B. パフォーマンス対策 (Performance)
100万件のリアクションが来た場合でもアプリがフリーズしないよう、以下の制限を設ける。

*   **描画上限**: 最大 **300個** まで描画。
    *   300個あれば画面は物理的に埋め尽くされるため、それ以上描画しても視覚効果は変わらない（重なるだけ）。
    *   これにより、データ上のカウントが無限に増えても、レンダリング負荷は一定以下に抑えられる。
*   **軽量化**: アイコンは画像ではなく `Text` (Emoji) ウィジェットを使用し、メモリ消費を抑制。

---

## 4. リアクションの種類 (Reaction Types)

約50種類のアイコンを定義（`lib/core/constants/app_constants.dart`）。

### カテゴリ
1.  **基本**: ❤️, ✨, 💪, 🤝, 🎈, ☺️, 🍌
2.  **拡張 (LINE風)**:
    *   **記号/自然**: ⭐, 🔥, ☀️, 🌙, 🌈, 🌸
    *   **ジェスチャー**: 👍, 🙆, 👏
    *   **表情**: 😊, 😆, 😂, 😉, 😘, 😍, 😌, 🥳, 😎
    *   **動物**: 🐱, 🐶, 🐻, 🐰, 🐼
    *   **食べ物/物**: 🎁, 🏆, 🥇, 🎵, ☕, 🍺, 🍰, 🍣, 🚀, 🍙

---

## 5. 今後の拡張性
*   **アニメーション**: リアクション追加時に、そのアイコンが飛び出すエフェクトの追加。
*   **カスタム**: ユーザーが好きな絵文字を使えるようにする（現在は定義済みEnumのみ）。

---

## 6. AIリアクションシステム (AI Interactions)
ユーザーの投稿に対して、AIたちが自動でリアクションを行う「お祭り機能」です。

### 動作仕様
*   **トリガー**: ユーザーが投稿を作成した瞬間 (`onPostCreated`)。
*   **挙動**:
    1.  **AIコメント**: 3〜10人のAIがコメント（+リアクション）を行う。
    2.  **リアクションバースト**: コメントをしないAIも含め、**15〜30人** のAIがランダムにリアクションを行う。
*   **時間差演出**:
    *   すべてのリアクションが同時に付くのではなく、**10秒〜60分** かけてランダムなタイミングで徐々に増えていく。
    *   これにより、リアルタイムで「盛り上がっている感」を演出する。
*   **ポジティブ厳選**: AIが使用するリアクションは、ポジティブな意味を持つもの（❤️, 👏, ✨, 👍, 😆 など）に限定される。

