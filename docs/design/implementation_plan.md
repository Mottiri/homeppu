# サークル機能設計書 (Draft v4)

## 1. 概要
「同じ目標を持つ仲間」が集まり、励まし合いながら継続するための機能。
**チャットではなく「サークル内フィード」形式**で実装する。
TLとの差別化を図り、「閉じられた安心感」のあるUIを提供する。

## 2. コンセプト & ポリシー
*   **サークル内フィード**: 投稿機能をベースにするが、メインTLとは明確に区別する。
*   **AIは「仲間」**: 先生やトレーナーではなく、**「一緒に頑張る同志」**として振る舞う。
*   **ポジティブ限定**: モデレーションは既存機能を流用。

## 3. 機能要件

### 3.1 サークル作成とAIモード
作成時に以下の **AIモード** を選択する。

| モード | 参加者構成 | AIの生成・挙動 |
|---|---|---|
| **AIモード** | 自分 + AI数人 | **【自分と同じ目標を持つAI】を生成**<br>指導者ではなく、**「私もダイエット頑張りたい！一緒にやろう！」という共感型AI**を生成する。<br>ユーザーと同じ目線で悩み、励ます存在。 |
| **ミックス** | 人間 + AI | **【同じ目標を持つAI】が参加**<br>サークルの目標（例: 資格取得）に合致したバックグラウンドを持つAIを生成・参加させる。<br>「過疎り防止」かつ「良きペースメーカー」として機能する。 |
| **人間モード** | 人間のみ | AIは参加しない。ストイックな人間同士の交流。 |

### 3.2 その他の設定
*   **公開/非公開**: 検索可否。
*   **人数制限**: **20名程度**（顔が見える距離感）。
*   **カテゴリ/目標**: AI生成の種として最重要。

### 3.3 サークル活動（フィード）
*   **フィード形式**: 時系列の掲示板。
*   **タスク達成の自動共有**: `task_feature_design.md` に準拠。

## 4. データ構造 (Firestore Schema)

### `circles` (Collection)
| Field | Type | Description |
|---|---|---|
| id | string | CID |
| name | string | サークル名 |
| aiMode | string | `'ai_only' | 'mix' | 'human_only'` |
| generatedAIs | array | `[{ name: '同志AI', characterId: '...' }]` |
| goal | string | 目標（AI生成のプロンプトに使用） |
| ... | ... | その他基本情報 |

### `posts` (Collection Extension)
*   `circleId`: string
*   **既存拡張**: 既存 `posts` の拡張だが、クエリで明確に分離する。

## 5. UI/UX: TLとの差別化 (重要)

「ただの投稿」と混同されないよう、**「サークルという部屋の中にいる」** 感覚をUIで演出する。

1.  **ヘッダー情報の常時表示**:
    *   画面上部にサークル名、目標、メンバーアイコン（AI含む）を常に表示する。
    *   メインTL（無限スクロール）とは異なる「空間の有限性」を強調する。
2.  **専用のデザインテーマ**:
    *   サークル画面内では、背景色を薄いアクセントカラーにする、あるいは投稿カードのデザインを少し変える（枠線を付ける等）ことで、視覚的に区別する。
3.  **専用の投稿ボタン (FAB)**:
    *   サークル画面内のFABを押すと、**自動的にそのサークルへの投稿**として作成画面が開く。
    *   「どこに投稿しよう？」と迷わせない導線設計。

## 6. AIの実装方針 (Cloud Functions)
*   **AI生成トリガー**:
    *   サークルの `goal` と `category` を入力として、Gemini APIに「同じ目標を持つ親しみやすいキャラクター」を生成させる。
    *   プロンプト例: *"あなたは『ダイエット』を目標にしている20代女性です。ユーザーと一緒に頑張る仲間として振る舞ってください。上から目線のアドバイスは禁止です。共感してください。"*

## 7. 実装ステップ
1.  **Model**: `Circle` モデル (aiMode, goal対応)。
2.  **UI**: サークル作成画面 (AIモード選択)。
3.  **UI**: サークル詳細画面 (ヘッダー強調、独自デザイン)。
4.  **Backend**: サークル用AI生成ロジックの実装。
