# タスク機能設計書 (v3)

## 1. 概要
ユーザーが日々の目標を管理し、達成を積み上げるためのコア機能。
**「サークルとの連携」「公開範囲の細分化」「メディア記録（Proof of Work）」**に加え、**「快適な操作性（Optimistic UI）」**を重視する。

## 2. タスク区分（Updated）
ユーザーのメンタルモデルに合わせて整理。

| 区分 | 内部ID | 説明 | 備考 |
|---|---|---|---|
| **通常タスク** | `todo` | 一般的なタスク。 | デフォルト |
| **カテゴリタスク** | - | ユーザー作成のカテゴリに属するタスク。 | |
| ~~**デイリー**~~ | - | (廃止) 通常タスクの繰り返し設定で代用。 | |

## 3. スケジュール管理 (Time Management)

### 3.1 データ構造
`TaskModel` の主要フィールド:

| Field | Description |
|---|---|
| `recurrenceInterval`, `recurrenceUnit` | 繰り返し設定（毎日, 毎週, 毎月）。Googleカレンダー連携は廃止し、アプリ内完結型へ移行。 |
| `priority` | 優先度 (0:低, 1:中, 2:高)。 |
| `subtasks` | サブタスクリスト。 |
| `isCompleted`, `lastCompletedAt` | 完了状態管理。 |

### 3.2 UI/UX (Current)
*   **タスクカードデザイン**:
    *   **通常モード**:
        *   **左側**: 余白のみ（チェックボックスなし）。
        *   **右側**: 「完了」ボタン（未完了時） / 「戻す」ボタン（完了時）。
        *   **アクション**: 「完了」ボタンタップで**即時反映（Optimistic UI）**。
    *   **編集モード**:
        *   **左側**: 選択用チェックボックス（24px, Square）。
        *   **右側**: アイコン類は非表示。
        *   **アクション**: カード全体タップで選択トグル。
*   **週間カレンダー**:
    *   **日付移動**: タップで瞬時に日付切り替え（アニメーションなし）。
    *   **今日に戻る**: ボタンで瞬時に今週・今日へ復帰。

## 4. 削除機能とUX
*   **削除フロー**:
    *   **スワイプ削除**: 編集モード時のみ有効。
    *   **一括削除**: 複数選択して削除ボタン。
*   **確認ダイアログ**:
    *   通常タスク: 削除確認のみ。
    *   繰り返しタスク: 「今回のみ削除」であることを明記。
    *   **永続化オプション**: 「今後表示しない」チェックボックスを実装済み（`SharedPreferences`）。
*   **Optimistic UI（楽観的UI）導入済み**:
    *   削除・完了操作は、サーバー通信を待たずにUIから即時反映。
    *   通信エラー時のみロールバック＆SnackBar通知。
    *   これにより「連打」や「消えない」ストレスを解消。

## 5. 公開範囲と共有 (Visibility & Sharing)
*   **公開設定**: `isPublic` フラグにより、サークルまたは全体への共有を制御（実装済み）。
*   **達成の記録**: 画像付きで完了する機能（Proof of Work）をサポート。

## 6. 新機能 (Future Work)

### 6.1 目標（Goal）と達成感の可視化
*   **コンセプト**: 「進捗バー」や「カレンダー」ではなく、**「彩り（Saturation）」**で積み上げを表現する。
*   **UIイメージ**:
    *   **Goal Card**: 大きなカードとして表示。
    *   **Visual Feedback**:
        *   初期状態: モノクロ、または薄い色のカード。
        *   タスク達成時: 紐づいたタスクを完了するたびに、カードの色が鮮やかになる（彩度が上がる）。
        *   **「色付いていく」**ことで、努力が形になる過程を直感的に楽しめるデザイン。
    *   **カレンダー不要**: 目標詳細画面では日付カレンダーは強調せず、この「カードの変化」と「紐づいたタスク一覧」をメインにする。

### 6.2 タスクの拡張 (Task Enrichment)
*   **メモ/説明**: 詳細なメモ（リスト、リンク、コンテキストなど）を追加するためのテキストエリア。
*   **添付ファイル**:
    *   **画像**: 写真（請求書、スクリーンショット、インスピレーションなど）を添付。
    *   **ファイル**: ドキュメント（PDFなど）を添付 - *ストレージ制限を確認*。
