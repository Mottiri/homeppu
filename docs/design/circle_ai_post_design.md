# ã‚µãƒ¼ã‚¯ãƒ«AIæŠ•ç¨¿æ©Ÿèƒ½ è¨­è¨ˆæ›¸

## æ¦‚è¦

ã‚µãƒ¼ã‚¯ãƒ«å†…ã§AIãŒè‡ªå‹•çš„ã«æŠ•ç¨¿ã‚’ç”Ÿæˆã—ã€ã‚µãƒ¼ã‚¯ãƒ«ã®æ´»æ€§åŒ–ã‚’å›³ã‚‹æ©Ÿèƒ½ã§ã™ã€‚

## æ©Ÿèƒ½ä»•æ§˜

### å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°

- **Cloud Scheduler**: æ¯æ—¥ 9:00 ã¨ 20:00 (JST) ã«å®Ÿè¡Œ
- **Cloud Tasks**: 0ã€œ3æ™‚é–“ã®ãƒ©ãƒ³ãƒ€ãƒ é…å»¶ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆè‡ªç„¶ãªæŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ¼”å‡ºï¼‰

### æŠ•ç¨¿æ¡ä»¶

- ã‚µãƒ¼ã‚¯ãƒ«ã«`generatedAIs`ï¼ˆAI ãƒ¡ãƒ³ãƒãƒ¼ï¼‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
- å½“æ—¥ã®æŠ•ç¨¿ãŒ2ä»¶æœªæº€ã§ã‚ã‚‹ã“ã¨
- ã‚µãƒ¼ã‚¯ãƒ«ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã“ã¨

### æŠ•ç¨¿è€…ã®é¸æŠ

- ã‚µãƒ¼ã‚¯ãƒ«ã®`generatedAIs`ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ä½“ã‚’é¸æŠ
- AI ã®åå‰ã¨ã‚¢ãƒã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã¦æŠ•ç¨¿

---

## AIæŠ•ç¨¿ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```typescript
function getCircleAIPostPrompt(
  aiName: string,
  circleName: string,
  circleDescription: string,
  category: string,
  recentPosts: string[] = [] // éå»ã®æŠ•ç¨¿å†…å®¹ï¼ˆé‡è¤‡å›é¿ç”¨ï¼‰
): string {
  const recentPostsSection = recentPosts.length > 0
    ? `
ã€é¿ã‘ã‚‹ã¹ãå†…å®¹ã€‘
ä»¥ä¸‹ã¯æœ€è¿‘ã®æŠ•ç¨¿ã§ã™ã€‚ã“ã‚Œã‚‰ã¨ä¼¼ãŸå†…å®¹ã‚„åŒã˜è¡¨ç¾ã¯çµ¶å¯¾ã«ä½¿ã‚ãªã„ã§ãã ã•ã„ï¼š
${recentPosts.map((p) => `- ${p}`).join("\n")}
`
    : "";

  return `
ã‚ãªãŸã¯ã€Œã»ã‚ã£ã·ã€ã¨ã„ã†SNSã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€Œ${aiName}ã€ã§ã™ã€‚
ã‚µãƒ¼ã‚¯ãƒ«ã€Œ${circleName}ã€ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦æŠ•ç¨¿ã—ã¾ã™ã€‚

ã€ã‚µãƒ¼ã‚¯ãƒ«æƒ…å ±ã€‘
- ã‚µãƒ¼ã‚¯ãƒ«å: ${circleName}
- ã‚«ãƒ†ã‚´ãƒª: ${category}
- èª¬æ˜: ${circleDescription}

ã€æŠ•ç¨¿ã®ãƒ«ãƒ¼ãƒ«ã€‘
1. ã‚µãƒ¼ã‚¯ãƒ«ã®ãƒ†ãƒ¼ãƒã«æ²¿ã£ãŸã€Œé ‘å¼µã‚Šå ±å‘Šã€ã‚„ã€Œé€²æ—å ±å‘Šã€ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„
2. åˆå¿ƒè€…ã€œä¸­ç´šè€…ã®è¦–ç‚¹ã§ã€ã€Œå®Œç’§ã˜ã‚ƒãªã„ã€ã€Œæˆé•·é€”ä¸­ã€ã‚’æ¼”å‡ºã—ã¦ãã ã•ã„
3. è‡ªç„¶ãªæ—¥æœ¬èªã§ã€SNSã‚‰ã—ã„ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªæŠ•ç¨¿ã«ã—ã¦ãã ã•ã„
4. çµµæ–‡å­—ã‚’1ã€œ2å€‹ä½¿ã£ã¦ãã ã•ã„
5. 30ã€œ80æ–‡å­—ç¨‹åº¦ã®çŸ­ã„æŠ•ç¨¿ã«ã—ã¦ãã ã•ã„
6. ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆ#â—‹â—‹ï¼‰ã¯çµ¶å¯¾ã«ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
7. æ¯å›ç•°ãªã‚‹å†…å®¹ãƒ»è¡¨ç¾ã§æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼ˆåŒã˜æ–‡ç« ã®ä½¿ã„å›ã—NGï¼‰

ã€é¿ã‘ã‚‹ã¹ãè¡¨ç¾ã€‘
- ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ï¼ˆ#å‹‰å¼· #è³‡æ ¼ ãªã©ï¼‰
- å‰å›ã¨åŒã˜å†…å®¹
- ã€Œãƒ†ã‚­ã‚¹ãƒˆä¸€å‘¨çµ‚ã‚ã£ãŸã€ãªã©åŒã˜ãƒ•ãƒ¬ãƒ¼ã‚ºã®ç¹°ã‚Šè¿”ã—
${recentPostsSection}
ã€æŠ•ç¨¿ä¾‹ã€‘
- ã€Œä»Šæ—¥ã‚‚${circleName}é ‘å¼µã£ãŸï¼ã¾ã ã¾ã ã ã‘ã©å°‘ã—ãšã¤é€²æ­©ã—ã¦ã‚‹æ°—ãŒã™ã‚‹ğŸ’ªã€
- ã€Œ${category}å§‹ã‚ã¦1é€±é–“ã€‚æœ€åˆã¯å…¨ç„¶ã ã£ãŸã‘ã©ã€ã¡ã‚‡ã£ã¨ãšã¤æˆé•·ã—ã¦ã‚‹ã‹ã‚‚âœ¨ã€
- ã€Œä»Šæ—¥ã¯èª¿å­æ‚ªã‹ã£ãŸã‘ã©ã€ã¨ã‚Šã‚ãˆãšã‚„ã£ãŸï¼ç¶™ç¶šã™ã‚‹ã“ã¨ãŒå¤§äº‹ğŸ”¥ã€

ã€ã‚ãªãŸã®æŠ•ç¨¿ã€‘
`;
}
```

---

## é‡è¤‡æŠ•ç¨¿é˜²æ­¢

### å¯¾ç­–

1. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã®æŒ‡ç¤º**: éå»5ä»¶ã®æŠ•ç¨¿å†…å®¹ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã€ã€Œã“ã‚Œã‚‰ã¨ä¼¼ãŸå†…å®¹ã¯ä½¿ã‚ãªã„ã§ã€ã¨æŒ‡ç¤º
2. **ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‰Šé™¤**: ç”Ÿæˆå¾Œã«ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ãŸã‚‰æ­£è¦è¡¨ç¾ã§å‰Šé™¤

### å®Ÿè£…

```typescript
// éå»ã®æŠ•ç¨¿ã‚’å–å¾—ï¼ˆé‡è¤‡å›é¿ç”¨ï¼‰
const recentPostsSnapshot = await db.collection("posts")
  .where("circleId", "==", circleId)
  .orderBy("createdAt", "desc")
  .limit(5)
  .get();

const recentPostContents = recentPostsSnapshot.docs
  .map(doc => doc.data().content as string)
  .filter(Boolean);

// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«éå»æŠ•ç¨¿ã‚’æ¸¡ã™
const prompt = getCircleAIPostPrompt(
  aiName, circleName, circleDescription, circleCategory, recentPostContents
);

// ç”Ÿæˆå¾Œã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°å‰Šé™¤ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
if (postContent) {
  postContent = postContent.replace(/#[^\s#]+/g, "").trim();
}
```

---

## Cloud Functions

| é–¢æ•°å | èª¬æ˜ |
|--------|------|
| `generateCircleAIPosts` | Cloud Scheduler ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã€Cloud Tasks ã«ã‚¿ã‚¹ã‚¯ã‚’ç™»éŒ² |
| `executeCircleAIPost` | Cloud Tasks ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã€å®Ÿéš›ã«æŠ•ç¨¿ã‚’ç”Ÿæˆãƒ»ä¿å­˜ |
| `triggerCircleAIPosts` | æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ç”¨ï¼ˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰ |

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å†…å®¹ |
|------|------|
| 2025-12-21 | ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ç¦æ­¢ã€é‡è¤‡æŠ•ç¨¿é˜²æ­¢ã‚’è¿½åŠ  |
