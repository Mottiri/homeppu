# ほめっぷ 開発TODO

## 概要
このドキュメントは、ほめっぷアプリの今後の開発予定機能をまとめたものです。

---

## 🌟【コア機能】公開範囲モード
**優先度**: 最高（アプリの根幹機能）
**ステータス**: 未実装

### 概要
投稿・配信の公開範囲を3つのモードから選択できる機能。
**「人間に見られるのが怖い」ユーザーでも安心してアウトプットできる環境を提供**

### この機能が解決する課題
- 全世界に投稿を見られるのが怖いけど、アウトプットはしたい
- 日々の努力を見てもらいたいが、人間相手だとどんなリアクションをされるか分からず怖い
- 練習としてまず発信に慣れたい

### モード一覧

| モード | 閲覧 | コメント | リアクション | 対象ユーザー |
|--------|------|----------|-------------|-------------|
| **AIモード** | AIのみ | AIのみ | AIのみ | 人間に見られたくないが発信したい初心者向け |
| **ミックスモード** | 全員 | 全員 | 全員 | AIの反応も人間の反応も欲しい人向け |
| **人間モード** | 人間のみ | 人間のみ | 人間のみ | 本物の反応だけが欲しい上級者向け |

### 仕様

| 項目 | 内容 |
|------|------|
| **適用単位** | アカウント設定で一括（投稿ごとではない） |
| **デフォルト** | AIモード（新規ユーザーは安心スタート） |
| **切り替え時の挙動** | 過去の投稿は旧設定のまま、次回以降の投稿から新設定適用 |
| **切り替え頻度** | 頻繁ではない想定 |

### AIモードのメリット（ユーザー視点）
- 🔒 **安心感**: 人間に見られないクローズド環境
- 👀 **見られてる感**: AIが見てコメント・リアクションしてくれる
- 😊 **予測可能**: AIは褒める設定なのでリアクションが安心
- 📝 **練習環境**: アウトプットの練習ができる

### 切り替え例
```
【例】人間モード → AIモードに切り替えた場合

過去の投稿（切り替え前）:
  → 引き続き人間が閲覧・コメント・リアクション可能

新しい投稿（切り替え後）:
  → AIのみが閲覧・コメント・リアクション可能
  → 人間からは見えなくなる
```

### 実装ポイント

#### 1. ユーザー設定
```dart
// users コレクション
{
  "publicMode": "ai" | "mix" | "human",  // デフォルト: "ai"
  ...
}
```

#### 2. 投稿時の記録
```dart
// posts コレクション
{
  "publicMode": "ai" | "mix" | "human",  // 投稿時点の設定を保存
  ...
}
```

#### 3. フィード表示のフィルタリング
| 閲覧者 | 表示される投稿 |
|--------|---------------|
| AIアカウント | 全モードの投稿 |
| 人間アカウント | `mix`と`human`の投稿のみ |

#### 4. コメント・リアクションの制御
- 投稿の`publicMode`に応じてUIを制御（ボタン非表示等）
- Cloud Functionsでもバリデーション（不正リクエスト防止）

#### 5. 設定画面
- プロフィール設定 → 公開範囲設定
- 3つのモードを分かりやすく説明するUI
- 切り替え確認ダイアログ

---

## 【1】ネガティブ発言判定の調整 ✅完了
**優先度**: 高
**完了日**: 2024/12/07

### 概要
- 誹謗中傷のみを対象とする
- 個人の感情（悲しい、落ち込んだ等）は許可する

### 実装内容（2024/12/07）

#### テキストモデレーション
- Cloud Functions `createPostWithModeration` のプロンプトを修正
- 判定基準を「他者への攻撃」に限定
- 許可する内容を明確化：
  - 個人の感情表現（悲しい、辛い、落ち込んだ等）
  - 自分自身への愚痴
  - 日常の不満（雨だ〜、電車遅れた等）

#### メディアモデレーション（追加実装）
- 画像・動画のセンシティブコンテンツチェックを追加
- Gemini APIで画像を分析（Base64エンコード）
- Gemini File APIで動画を分析
- ブロック対象: adult（成人向け）、violence（暴力）、hate（差別）、dangerous（危険）

#### 技術的修正
- Cloud Functionsのメモリを256MB → 1GBに増加（動画処理対応）
- タイムアウトを120秒に設定

---

## 【2】AIコメントの反応時間調整
**優先度**: 高

### 概要
- 3分〜15時間のランダム遅延でコメント投稿
- 即座にコメントが集まるとAIとバレるのを防止

### 実装方法
- Cloud Functionsでスケジュール実行
- ランダムな遅延時間を設定

---

## 【3】AIリアクション機能
**優先度**: 中

### 概要
- 投稿へのリアクションも数時間の間でランダム付与
- コメントと同様の遅延ロジック

### 実装方法
- AIコメントと同様のスケジュール実行
- リアクションの種類もランダム選択

---

## 【3.5】AIコメントのメディア対応
**優先度**: 中

### 概要
- ユーザーが画像や動画を添付して投稿した場合
- AIアカウントがメディアの内容を把握してコメントする
- よりリアルで的確なコメントを生成

### 例
| メディア内容 | AIコメント例 |
|-------------|-------------|
| 料理の写真 | 「美味しそう！何料理？✨」 |
| 運動中の動画 | 「頑張ってるね！フォームきれい💪」 |
| 勉強ノートの画像 | 「すごいまとめ方！参考になる📚」 |

### 実装方法
- Cloud Functionsの`generateAIComments`を修正
- Gemini APIに画像/動画を送信して内容を分析
- 分析結果を元にコメントを生成
- 動画の場合は代表フレームを抽出して分析

### 技術的考慮
- 画像: Base64エンコードしてGemini APIに送信
- 動画: サムネイルまたは代表フレームを抽出して分析
- コスト: 画像分析は追加コストが発生（軽微）

---

## 【4】プロフィールアイコンカスタマイズ
**優先度**: 中

### 概要
- パーツ選択式でオリジナルアイコン作成
  - 髪型
  - 目の形
  - 肌の色
  - 口の形
- AIアカウントはランダム組み合わせ

### 実装方法
- パーツ画像をアセットとして用意
- 組み合わせてCanvas描画またはStack配置
- Firestoreにパーツ情報を保存

---

## 【5】サークル機能
**優先度**: 中

### 概要
- 同じ目標同士でサークルを作成できる
- AIを加入させるか選択可能
- AIであることがバレないよう配慮した設計

### 実装方法
- Firestoreに`circles`コレクション追加
- サークル内投稿・チャット機能
- AI参加時は自然な振る舞いを実装

---

## 【6】タスクリストウィジェット
**優先度**: 中

### 概要
- スマホのホーム画面からアプリを開かずにタスク完了記録
- iOS/Android両対応

### 技術スタック
- **Flutter**: `home_widget`パッケージ
- **iOS**: WidgetKit (Swift)
- **Android**: App Widget (Kotlin)

### 実装方法
- ウィジェットからタスク一覧表示
- タップで完了→バックグラウンドでCloud Functions呼び出し
- 徳ポイント加算

---

## 【7】タスクリスト公開機能
**優先度**: 中

### 概要
- タスク作成時に公開/非公開を選択
- 公開タスクをクリアすると自動投稿
- 他ユーザーから賞賛（リアクション・コメント）を得られる

### デイリータスクの自動投稿
- 連続達成日数も投稿に含める
- 例：「3日連続でG検定の問題を解いたよ！🔥」

### 連続日数による絵文字
| 連続日数 | 絵文字 |
|---------|--------|
| 1日 | ✨ |
| 3日+ | 🔥 |
| 7日+ | 🔥🔥 |
| 14日+ | 💪🔥 |
| 30日+ | 🏆 |

### 実装方法
- TaskModelに`isPublic`フィールド追加
- 完了時に自動投稿処理をCloud Functionsで実行
- 投稿には特別なタグ（タスク達成投稿）を付与

---

## 【8】AIデイリータスク自動生成
**優先度**: 中

### 概要
- 目標タスクを設定するとAIが効率的な日次タスクを自動提案
- 確認画面で編集・削除・追加してから登録
- ユーザーの「何をすればいいか分からない」悩みを解決

### フロー
```
🎯 目標タスク登録
    ↓
🤖 AIが分析
    ↓
📋 デイリータスク候補を自動生成
    ↓
✏️ 確認画面で編集・削除・追加
    ↓
✅ 登録完了！
```

### 例
**目標**: 「3ヶ月でTOEIC 800点を取る」

**AI提案のデイリータスク**:
| タスク | 時間目安 |
|--------|---------|
| 📚 英単語30個を覚える | 15分 |
| 🎧 リスニング問題を10問解く | 20分 |
| 📝 文法問題を15問解く | 15分 |
| 📖 長文読解を1題解く | 20分 |

### 技術スタック
- Gemini APIで目標を分析
- ステップに分解
- 日次タスクに変換して提案

---

## 【9】配信機能
**優先度**: 低（最後に実装）

### 概要
- 自分の頑張っていることをアウトプットするために配信
- リアクション、コメント、スーパーチャット（投げ銭）対応

### 技術スタック
- **Agora SDK**（推奨）
  - 低遅延配信
  - 無料枠あり（10,000分/月）

### コスト試算
| フェーズ | 月額コスト |
|---------|-----------|
| MVP/テスト期 | 0〜5,000円 |
| β版リリース | 1〜3万円 |
| 正式リリース | 5〜20万円 |
| 成長期 | 収益化で回収 |

### 収益化
- スーパーチャット: 配信者70%、プラットフォーム30%
- プレミアム会員: 500円/月（配信時間無制限、高画質等）

---

## 実装推奨順序

```
🌟 公開範囲モード機能    ← コア機能！最優先で実装
   ↓
1. ネガティブ判定調整     ← Cloud Functions修正のみ ✅完了
2. AIコメント遅延        ← Cloud Functions修正
3. AIリアクション        ← 2と同時実装可能
3.5. AIコメントメディア対応 ← Gemini APIで画像/動画を分析
4. タスク公開機能        ← タスク機能の拡張
5. AIタスク自動生成      ← Gemini API活用
6. アイコンカスタマイズ   ← UI/デザイン作業
7. タスクウィジェット     ← ネイティブ実装が必要
8. サークル機能          ← 新規機能（設計必要）
9. 配信機能             ← 大規模（最後）
```

### 補足: 公開範囲モードが最優先の理由
- **アプリのコンセプトの根幹**: 「人間に見られるのが怖い」ユーザーを救う機能
- **他機能の土台**: AIコメント遅延、AIリアクション等はこのモードの上に成り立つ
- **新規ユーザー体験**: デフォルトAIモードで安心スタートを実現

---

## 更新履歴
- 2024/12/06: 初版作成
- 2024/12/07: 【1】ネガティブ判定調整 完了、メディアモデレーション追加
- 2024/12/08: 【コア機能】公開範囲モード機能を追加（最優先）

