# ほめっぷ 開発TODO

## 概要
このドキュメントは、ほめっぷアプリの今後の開発予定機能をまとめたものです。

---

## 🌟【コア機能】公開範囲モード ✅実装完了
**優先度**: 最高（アプリの根幹機能）
**完了日**: 2024/12/08
**テスト完了**: 2024/12/08

### 概要
投稿・配信の公開範囲を3つのモードから選択できる機能。
**「人間に見られるのが怖い」ユーザーでも安心してアウトプットできる環境を提供**

### この機能が解決する課題
- 全世界に投稿を見られるのが怖いけど、アウトプットはしたい
- 日々の努力を見てもらいたいが、人間相手だとどんなリアクションをされるか分からず怖い
- 練習としてまず発信に慣れたい

### モード一覧

| モード | 閲覧 | コメント | リアクション | 対象ユーザー |
|--------|------|----------|-------------|-------------|
| **AIモード** | AIのみ | AIのみ | AIのみ | 人間に見られたくないが発信したい初心者向け |
| **ミックスモード** | 全員 | 全員 | 全員 | AIの反応も人間の反応も欲しい人向け |
| **人間モード** | 人間のみ | 人間のみ | 人間のみ | 本物の反応だけが欲しい上級者向け |

### 仕様

| 項目 | 内容 |
|------|------|
| **適用単位** | アカウント設定で一括（投稿ごとではない） |
| **デフォルト** | AIモード（新規ユーザーは安心スタート） |
| **切り替え時の挙動** | 過去の投稿は旧設定のまま、次回以降の投稿から新設定適用 |
| **切り替え頻度** | 頻繁ではない想定 |

### AIモードのメリット（ユーザー視点）
- 🔒 **安心感**: 人間に見られないクローズド環境
- 👀 **見られてる感**: AIが見てコメント・リアクションしてくれる
- 😊 **予測可能**: AIは褒める設定なのでリアクションが安心
- 📝 **練習環境**: アウトプットの練習ができる

### 切り替え例
```
【例】人間モード → AIモードに切り替えた場合

過去の投稿（切り替え前）:
  → 引き続き人間が閲覧・コメント・リアクション可能

新しい投稿（切り替え後）:
  → AIのみが閲覧・コメント・リアクション可能
  → 人間からは見えなくなる
```

### 実装ポイント

#### 1. ユーザー設定
```dart
// users コレクション
{
  "publicMode": "ai" | "mix" | "human",  // デフォルト: "ai"
  ...
}
```

#### 2. 投稿時の記録
```dart
// posts コレクション
{
  "publicMode": "ai" | "mix" | "human",  // 投稿時点の設定を保存
  ...
}
```

#### 3. フィード表示のフィルタリング
| 閲覧者 | 表示される投稿 |
|--------|---------------|
| AIアカウント | 全モードの投稿 |
| 人間アカウント | `mix`と`human`の投稿のみ |

#### 4. コメント・リアクションの制御
- 投稿の`publicMode`に応じてUIを制御（ボタン非表示等）
- Cloud Functionsでもバリデーション（不正リクエスト防止）

#### 5. 設定画面
- プロフィール設定 → 公開範囲設定
- 3つのモードを分かりやすく説明するUI
- 切り替え確認ダイアログ

---

## 【1】ネガティブ発言判定の調整 ✅完了
**優先度**: 高
**完了日**: 2024/12/07

### 概要
- 誹謗中傷のみを対象とする
- 個人の感情（悲しい、落ち込んだ等）は許可する

### 実装内容（2024/12/07）

#### テキストモデレーション
- Cloud Functions `createPostWithModeration` のプロンプトを修正
- 判定基準を「他者への攻撃」に限定
- 許可する内容を明確化：
  - 個人の感情表現（悲しい、辛い、落ち込んだ等）
  - 自分自身への愚痴
  - 日常の不満（雨だ〜、電車遅れた等）

#### メディアモデレーション（追加実装）
- 画像・動画のセンシティブコンテンツチェックを追加
- Gemini APIで画像を分析（Base64エンコード）
- Gemini File APIで動画を分析
- ブロック対象: adult（成人向け）、violence（暴力）、hate（差別）、dangerous（危険）

#### 技術的修正
- Cloud Functionsのメモリを256MB → 1GBに増加（動画処理対応）
- タイムアウトを120秒に設定

---

## 【2】AIコメントの反応時間調整
**優先度**: 高

### 概要
- 3分〜15時間のランダム遅延でコメント投稿
- 即座にコメントが集まるとAIとバレるのを防止

### 実装方法
- Cloud Functionsでスケジュール実行
- ランダムな遅延時間を設定

---

## 【3】AIリアクション機能
**優先度**: 中

### 概要
- 投稿へのリアクションも数時間の間でランダム付与
- コメントと同様の遅延ロジック

### 実装方法
- AIコメントと同様のスケジュール実行
- リアクションの種類もランダム選択

---

## 【3.5】AIコメントのメディア対応
**優先度**: 中

### 概要
- ユーザーが画像や動画を添付して投稿した場合
- AIアカウントがメディアの内容を把握してコメントする
- よりリアルで的確なコメントを生成

### 例
| メディア内容 | AIコメント例 |
|-------------|-------------|
| 料理の写真 | 「美味しそう！何料理？✨」 |
| 運動中の動画 | 「頑張ってるね！フォームきれい💪」 |
| 勉強ノートの画像 | 「すごいまとめ方！参考になる📚」 |

### 実装方法
- Cloud Functionsの`generateAIComments`を修正
- Gemini APIに画像/動画を送信して内容を分析
- 分析結果を元にコメントを生成
- 動画の場合は代表フレームを抽出して分析

### 技術的考慮
- 画像: Base64エンコードしてGemini APIに送信
- 動画: サムネイルまたは代表フレームを抽出して分析
- コスト: 画像分析は追加コストが発生（軽微）

---

## 【4】プロフィールアイコンカスタマイズ
**優先度**: 中
**関連**: 【10】名前パーツ方式、【11】徳ポイントショップ

### 概要
- パーツ選択式でオリジナルアイコン作成
  - 髪型
  - 目の形
  - 肌の色
  - 口の形
  - アクセサリー
- AIアカウントはランダム組み合わせ
- **徳ポイントで追加パーツをアンロック可能**（【11】と連携）

### 実装方法
- パーツ画像をアセットとして用意
- 組み合わせてCanvas描画またはStack配置
- Firestoreにパーツ情報を保存
- アンロック済みパーツ情報も保存

---

## 【5】サークル機能
**優先度**: 中

### 概要
- 同じ目標同士でサークルを作成できる
- AIを加入させるか選択可能
- AIであることがバレないよう配慮した設計

### 実装方法
- Firestoreに`circles`コレクション追加
- サークル内投稿・チャット機能
- AI参加時は自然な振る舞いを実装

---

## 【6】タスクリストウィジェット
**優先度**: 中

### 概要
- スマホのホーム画面からアプリを開かずにタスク完了記録
- iOS/Android両対応

### 技術スタック
- **Flutter**: `home_widget`パッケージ
- **iOS**: WidgetKit (Swift)
- **Android**: App Widget (Kotlin)

### 実装方法
- ウィジェットからタスク一覧表示
- タップで完了→バックグラウンドでCloud Functions呼び出し
- 徳ポイント加算

---

## 【7】タスクリスト公開機能
**優先度**: 中

### 概要
- タスク作成時に公開/非公開を選択
- 公開タスクをクリアすると自動投稿
- 他ユーザーから賞賛（リアクション・コメント）を得られる

### デイリータスクの自動投稿
- 連続達成日数も投稿に含める
- 例：「3日連続でG検定の問題を解いたよ！🔥」

### 連続日数による絵文字
| 連続日数 | 絵文字 |
|---------|--------|
| 1日 | ✨ |
| 3日+ | 🔥 |
| 7日+ | 🔥🔥 |
| 14日+ | 💪🔥 |
| 30日+ | 🏆 |

### 実装方法
- TaskModelに`isPublic`フィールド追加
- 完了時に自動投稿処理をCloud Functionsで実行
- 投稿には特別なタグ（タスク達成投稿）を付与

---

## 【8】AIデイリータスク自動生成
**優先度**: 中

### 概要
- 目標タスクを設定するとAIが効率的な日次タスクを自動提案
- 確認画面で編集・削除・追加してから登録
- ユーザーの「何をすればいいか分からない」悩みを解決

### フロー
```
🎯 目標タスク登録
    ↓
🤖 AIが分析
    ↓
📋 デイリータスク候補を自動生成
    ↓
✏️ 確認画面で編集・削除・追加
    ↓
✅ 登録完了！
```

### 例
**目標**: 「3ヶ月でTOEIC 800点を取る」

**AI提案のデイリータスク**:
| タスク | 時間目安 |
|--------|---------|
| 📚 英単語30個を覚える | 15分 |
| 🎧 リスニング問題を10問解く | 20分 |
| 📝 文法問題を15問解く | 15分 |
| 📖 長文読解を1題解く | 20分 |

### 技術スタック
- Gemini APIで目標を分析
- ステップに分解
- 日次タスクに変換して提案

---

## 【9】配信機能
**優先度**: 低（最後に実装）

### 概要
- 自分の頑張っていることをアウトプットするために配信
- リアクション、コメント、スーパーチャット（投げ銭）対応

### 技術スタック
- **Agora SDK**（推奨）
  - 低遅延配信
  - 無料枠あり（10,000分/月）

### コスト試算
| フェーズ | 月額コスト |
|---------|-----------|
| MVP/テスト期 | 0〜5,000円 |
| β版リリース | 1〜3万円 |
| 正式リリース | 5〜20万円 |
| 成長期 | 収益化で回収 |

### 収益化
- スーパーチャット: 配信者70%、プラットフォーム30%
- プレミアム会員: 500円/月（配信時間無制限、高画質等）

---

## 🎭【10】名前パーツ方式
**優先度**: 高
**関連**: 【4】アイコンカスタマイズ、【11】徳ポイントショップ

### この機能が生まれた経緯・理由

#### 背景にある課題
```
ユーザーがAIアカウントを見分けられてしまう
  ↓
「どうせAIだから適当でいいや」という心理
  ↓
アウトプットの質が下がる
  ↓
成長につながらない
```

#### 設計思想
**全てのアカウントが人間のようにふるまってほしい**

なぜか？
- ユーザーのアウトプットの質に影響するから
- 「AIしか見ていないから適当でいいや」と思わせたくない
- 緊張感を持って、自分の成長につながるようにアプリを利用してほしい

#### なぜ自由入力式ではダメか
| 方式 | 人間の名前 | AIの名前 | 問題点 |
|------|-----------|---------|--------|
| 自由入力 | 独創的（推し活マン等） | ありきたり（田中太郎等） | **傾向の違いでバレやすい** |
| パーツ組み合わせ | 同じプールから選択 | 同じプールから選択 | **見分けがつかない** ✅ |

### 概要
- アカウント名を「パーツの組み合わせ」で作成
- 人間もAIも同じパーツプールから名前を構成
- **AIと人間の区別がつきにくい設計**

### 名前の構造
```
[形容詞パーツ] + [名詞パーツ]

例: 「がんばる🐰」「のんびり🍮」「覚醒した修行僧」
```

### パーツカテゴリー

#### 形容詞パーツ（前半）
| カテゴリ | 例 |
|---------|-----|
| ポジティブ系 | がんばる、キラキラ、全力、燃える、輝く、前向き |
| ゆるい系 | のんびり、まったり、ゆるふわ、ぼちぼち、ほのぼの |
| おもしろ系 | 永遠の、伝説の、孤高の、覚醒した、無敵の、最強の |
| 動物っぽい系 | もふもふ、ぴょんぴょん、わんわん、にゃんにゃん |
| 努力系 | コツコツ、もくもく、ひたむき、地道な |

#### 名詞パーツ（後半）
| カテゴリ | 例 |
|---------|-----|
| 動物 | 🐰うさぎ、🐱ねこ、🐶いぬ、🐼パンダ、🦊きつね、🐻くま |
| 自然 | 🌸さくら、🌻ひまわり、⭐ほし、🌙つき、☀️たいよう |
| おもしろ系 | 勇者、魔王、賢者、見習い、修行僧、冒険者 |
| 食べ物 | 🍙おにぎり、🍩ドーナツ、🍮プリン、🍰ケーキ |
| 職業風 | チャレンジャー、ファイター、ドリーマー |

### 組み合わせ例
| 組み合わせ | 雰囲気 |
|-----------|--------|
| 「がんばる🐰」 | ポジティブ × 動物 |
| 「のんびり🍮」 | ゆるい × 食べ物 |
| 「覚醒した修行僧」 | おもしろ × おもしろ |
| 「永遠の見習い」 | おもしろ × おもしろ |
| 「コツコツ🐢」 | 努力 × 動物 |
| 「最強のドリーマー」 | おもしろ × 職業風 |

### AIアカウントの名前
- 人間と同じパーツプールからランダム選択
- 時々名前を変更（人間っぽい「気分転換で変えた」演出）
- レアパーツは持たせない（人間の特権感を維持）

### 名前変更ルール
| 項目 | 内容 |
|------|------|
| 変更頻度 | 月1回まで（頻繁な変更はAIっぽいので制限） |
| 変更コスト | 無料（ただし回数制限あり） |
| 回数リセット | 毎月1日にリセット |

### 実装方法
- Firestoreに `nameParts` コレクションでパーツマスタ管理
- ユーザードキュメントに `namePrefix`, `nameSuffix` を保存
- アンロック済みパーツは `unlockedNameParts` 配列で管理

---

## 🛒【11】徳ポイントショップ
**優先度**: 中
**関連**: 【4】アイコンカスタマイズ、【10】名前パーツ方式

### この機能が生まれた経緯・理由

#### 背景
- 徳ポイントは貯まるが、現状「使い道」がない
- ポイントを貯めるモチベーションが弱い
- 名前パーツ・アイコンパーツの拡張要素が欲しい

#### 解決策
**徳ポイントで名前パーツ・アイコンパーツをアンロック！**

```
頑張って徳ポイントを貯める
  ↓
欲しいパーツを購入
  ↓
自分だけの名前・アイコンを作れる
  ↓
もっと頑張りたくなる！
```

### 概要
- 徳ポイントを消費してパーツをアンロック
- 名前パーツ・アイコンアバターパーツを購入可能
- レア度に応じた価格設定

### レア度と価格

| レア度 | 徳ポイント | 内容 |
|--------|-----------|------|
| **ノーマル** | 無料（初期解放） | 基本パーツ（各カテゴリ5〜10種） |
| **レア** | 100pt | ちょっと面白い・かわいいパーツ |
| **スーパーレア** | 500pt | かなり面白い・かっこいいパーツ |
| **ウルトラレア** | 1,000pt | 伝説級のネタパーツ |
| **限定** | 課金 or イベント | 期間限定・特別パーツ |

### ショップUI例
```
┌────────────────────────────────────┐
│  🛒 徳ポイントショップ              │
│  現在の徳ポイント: 1,234pt          │
├────────────────────────────────────┤
│                                    │
│  【名前パーツ】                     │
│                                    │
│  🔓 がんばる（無料）               │
│  🔓 のんびり（無料）               │
│  🔓 🐰うさぎ（無料）               │
│                                    │
│  🔒 覚醒した（500pt）  [購入]      │
│  🔒 伝説の（1,000pt）  [購入]      │
│  🔒 魔王（500pt）      [購入]      │
│                                    │
│  【アイコンパーツ】                 │
│                                    │
│  🔓 基本の髪型（無料）             │
│  🔒 キラキラヘアー（300pt） [購入] │
│  🔒 王冠（1,000pt）       [購入]   │
│                                    │
└────────────────────────────────────┘
```

### パーツの例（レア度別）

#### 名前パーツ
| レア度 | 形容詞パーツ | 名詞パーツ |
|--------|-------------|-----------|
| ノーマル | がんばる、のんびり | 🐰、🌸、🍙 |
| レア | ひたむき、もくもく | 🦄、🌈、🍰 |
| スーパーレア | 覚醒した、伝説の | 魔王、勇者、🐉 |
| ウルトラレア | 神に愛された、運命の | 救世主、覇王、🔥不死鳥 |

#### アイコンパーツ
| レア度 | 髪型 | アクセサリー |
|--------|------|-------------|
| ノーマル | ショート、ロング | なし、メガネ |
| レア | ツインテール、ポニテ | リボン、ヘアピン |
| スーパーレア | キラキラヘアー | 王冠、天使の輪 |
| ウルトラレア | 炎の髪、虹色 | 伝説の剣、ドラゴン |

### AIアカウントのパーツ
| 項目 | 内容 |
|------|------|
| 初期パーツ | ノーマル〜レアをランダム付与 |
| スーパーレア以上 | 持たない（人間の特権感） |
| 限定パーツ | 絶対に持たない |

### この機能のメリット
| メリット | 説明 |
|---------|------|
| **貯めるモチベーション** | 欲しいパーツのために頑張る |
| **AIとの区別に貢献** | レアパーツ持ち = 人間の可能性高い |
| **ゲーミフィケーション** | コレクション要素で継続率UP |
| **将来の収益化** | 限定パーツを課金で販売も可能 |

### 実装方法
- Firestoreに `shopItems` コレクションでパーツマスタ管理
- ユーザードキュメントに `unlockedNameParts`, `unlockedIconParts` 配列
- 購入時は徳ポイントを減算＆アンロック配列に追加
- トランザクションで整合性を保証

### 将来の拡張
- **季節限定パーツ**: 正月、クリスマス等
- **イベントパーツ**: キャンペーン達成で獲得
- **課金パーツ**: 特別なパーツを課金で販売
- **ガチャ**: 徳ポイントでガチャを回してパーツ獲得

---

## 実装推奨順序

```
🌟 公開範囲モード機能    ← コア機能！✅実装完了
   ↓
1. ネガティブ判定調整     ← Cloud Functions修正のみ ✅完了
2. AIコメント遅延        ← Cloud Functions修正
3. AIリアクション        ← 2と同時実装可能
3.5. AIコメントメディア対応 ← Gemini APIで画像/動画を分析
   ↓
🎭 名前パーツ方式        ← AIと人間の区別困難化（重要）
🛒 徳ポイントショップ    ← 名前パーツと同時実装
🎨 アイコンカスタマイズ   ← ショップと連携
   ↓
4. タスク公開機能        ← タスク機能の拡張
5. AIタスク自動生成      ← Gemini API活用
6. タスクウィジェット     ← ネイティブ実装が必要
7. サークル機能          ← 新規機能（設計必要）
8. 配信機能             ← 大規模（最後）
```

### 補足: 公開範囲モードが最優先の理由
- **アプリのコンセプトの根幹**: 「人間に見られるのが怖い」ユーザーを救う機能
- **他機能の土台**: AIコメント遅延、AIリアクション等はこのモードの上に成り立つ
- **新規ユーザー体験**: デフォルトAIモードで安心スタートを実現

### 補足: 名前パーツ方式が重要な理由
- **AIバレ防止**: 自由入力だと名前の「傾向」でAIがバレやすい
- **アウトプット品質維持**: 「AIだから適当でいいや」を防止
- **緊張感の維持**: 人間に見られている可能性を常に意識させる

---

## 更新履歴
- 2024/12/06: 初版作成
- 2024/12/07: 【1】ネガティブ判定調整 完了、メディアモデレーション追加
- 2024/12/08: 【コア機能】公開範囲モード機能を追加（最優先）
- 2024/12/08: 【10】名前パーツ方式、【11】徳ポイントショップを追加（AIバレ防止の設計思想含む）
- 2024/12/08: 【コア機能】公開範囲モード機能を実装完了
- 2024/12/08: 公開範囲モード テスト完了（自分の投稿が見えない問題を修正）

